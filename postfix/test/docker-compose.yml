version: '3.7'

services:
  postfix:

    build:
      context: docker/postfix

    ports:
      - target: 25
        published: 25
        protocol: tcp
        mode: host


    volumes:
      - ./etc:/opt/postfix/conf
      - ./log:/var/log/host
      - ./spool:/opt/postfix/spool
      - ./data:/opt/postfix/data

    # environment:
    #   - MULTI_INSTANCE_NAME="MX"

    environment:
      MULTI_INSTANCE_NAME:      MX
      MY_HOSTNAME:              mx3.ametel.es
      MY_NETWORKS:              127.0.0.1
      SMTP_BIND_ADDRESS:        51.91.13.123
      VIRTUAL_MAILBOX_DOMAINS:  hash:/opt/postfix/conf/domains

    networks:
      - localNetwork

  postmap:
    build:
      context: docker/postmap

    volumes:
      - ./etc:/opt/postfix/conf


networks:
  localNetwork:

